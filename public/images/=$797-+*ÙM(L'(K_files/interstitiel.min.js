var showADNInterstiel;(function(){showADNInterstiel=function(data){console.log("showADNInterstiel",data);var interstitiel=new ADNInterstiel(data);interstitiel.show()};function ADNInterstiel(data){this.interstielNode=document.querySelector(".adn-interstitiel");this.closeButtonNode=this.interstielNode.querySelector(".adn-interstitiel-close-button");this.contentNode=this.interstielNode.querySelector(".adn-interstitiel-content");this.videoNode=this.interstielNode.querySelector(".adn-interstitiel-video");this.contentNode.innerHTML="";this.videoNode.innerHTML="";this.linkNode=this.interstielNode.querySelector("a");this.interstielBackgroundNode=document.querySelector(".adn-interstitiel-background");this.data=data;this.width=500;this.height=500;this.padding=12;this.margin={top:86,bottom:0,left:0,right:0};this.ratio=1;this.size=1;this.withVideo=data.video!=undefined;this.time=data.time||this.interstielNode.dataset.time||0;this.video=null}ADNInterstiel.prototype.show=function(){var image=document.createElement("img");var self=this;image.addEventListener("load",function(){self.calculateSize(this.naturalWidth,this.naturalHeight)});image.src=this.data.image;this.contentNode.append(image)};ADNInterstiel.prototype.calculateSize=function(width,height){var windowSize=this.getWindowSize();this.height=height+2*this.padding;this.width=width+2*this.padding;this.ratio=this.width/this.height;if(this.ratio<windowSize.ratio){if(this.height>windowSize.height){this.height=windowSize.height;this.width=this.height*this.ratio}}else{if(this.width>windowSize.width){this.width=windowSize.width;this.height=this.width/this.ratio}}this.size=(this.width-this.padding*2)/width;this.linkNode.href=this.data.url;this.contentNode.style.backgroundColor=this.data.color||"#000";this.interstielNode.style.width=Math.round(this.width)+"px";this.interstielNode.style.height=Math.round(this.height)+"px";this.interstielNode.style.marginLeft=Math.round(-this.width/2+this.margin.left/2)+"px";this.interstielNode.style.marginTop=Math.round(-this.height/2+this.margin.top/2)+"px";if(this.withVideo==true){this.addVideo();this.interstielNode.classList.remove("hide");this.interstielBackgroundNode.classList.remove("hide");return}this.interstielNode.classList.remove("hide");this.interstielBackgroundNode.classList.remove("hide");this.startCountDown()};ADNInterstiel.prototype.addVolumeButton=function(){var volumeButton=document.createElement("div");volumeButton.className="adn-interstitiel-video-volume-button";volumeButton.innerText="Activer le son";this.videoNode.append(volumeButton);var that=this;volumeButton.addEventListener("click",function(e){if(that.video.muted){that.video.muted=false;if(that.video.volume<.1){that.video.volume=.5}volumeButton.remove()}})};ADNInterstiel.prototype.addVideo=function(){this.video=document.createElement("video");this.video.src=this.data.video;this.video.muted=true;this.videoNode.append(this.video);this.videoNode.style.width=Math.round((this.data.videoSize.w||160)*this.size)+"px";this.videoNode.style.height=Math.round((this.data.videoSize.h||90)*this.size)+"px";this.videoNode.style.top=Math.round(this.padding+(this.data.videoPosition.y||0)*this.size)+"px";this.videoNode.style.left=Math.round(this.padding+(this.data.videoPosition.x||0)*this.size)+"px";var self=this;if(this.data.addVideoTime==true){var coundDownStarded=false;this.video.addEventListener("loadedmetadata",function(){coundDownStarded=true;self.time+=Math.round(video.duration);self.startCountDown()});this.video.addEventListener("ended",function(){if(!coundDownStarded){coundDownStarded=true;self.startCountDown()}})}else{self.startCountDown()}this.videoNode.classList.remove("hide");this.addVolumeButton();this.video.play()};ADNInterstiel.prototype.hide=function(){this.interstielNode.classList.add("hide");this.interstielBackgroundNode.classList.add("hide");if(this.video){this.video.pause();this.video=null}};ADNInterstiel.prototype.startCountDown=function(){var self=this;self.closeButtonNode.innerText=this.time;self.closeButtonNode.classList.remove("hide");this.countDown(this.time,function(time){if(time==0){self.closeButtonNode.innerHTML='<span data-icon="&#xe016;"></span>';self.closeButtonNode.style.cursor="pointer";self.closeButtonNode.addEventListener("click",self.hide.bind(self));self.interstielBackgroundNode.addEventListener("click",self.hide.bind(self));return}self.closeButtonNode.innerText=time})};ADNInterstiel.prototype.countDown=function(timeToWait,callback){var self=this;setTimeout(function(){timeToWait=timeToWait-1;if(timeToWait<=0){callback(0);return}callback(timeToWait);self.countDown(timeToWait,callback)},1e3)};ADNInterstiel.prototype.getWindowSize=function(){var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight;return{width:x-this.margin.left-this.margin.right,height:y-this.margin.top-this.margin.bottom,ratio:x/y}}})();